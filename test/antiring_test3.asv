% images
img0 = loaddcmimage('F:\data-Dier.Z\imgdata\701_Original');
% input paramters
imgcenter = [0, 2.1091623];
FOV = 250;
hx_ISO = 0.6110;
imagesize = 512;
Nslice = 32;
pitch = 1/2;

% T
img0T = permute(img0, [2 1 3]);

% anti-ring paramters
ringfilter1 = [-1/4 -1/4 1 -1/4 -1/4];
Nrow = 16;
% I know Nrow = Nslice*pitch;
rotdirect = 1;
Lb = 1050-150;
Ub = 1050+150;
Ntheta = 192;
d_radius = hx_ISO*imagesize/FOV;
Zsample = 2;
% I know Zsample = 1/pitch;

imgfix1 = antiringonhelical(img0T, imgcenter, Npitch, rotdirect, Lb, Ub, Ntheta, d_radius, Zsample, true, 0.1, ringfilter1);

% fixed image1
img1T = img0T - imgfix1;
img1 = permute(img1T, [2 1 3]);
% try to compare img1 with img0 ...

% merge to thick image
Nmerge = 8;
% anti-ring again on thick image
img1Tm = squeeze(mean(reshape(img1T, imagesize, imagesize, Nmerge, []), 3));
ringfilter2 = [-1/2 1 -1/2];
imgfix2 = antiringonimage(img1Tm, center, Lb, Ub, Ntheta, d, true, restcut, ringfilter2);
% fixed image2
img2Tm = img1Tm - imgfix2;

img0m = squeeze(mean(reshape(img0, imagesize, imagesize, Nmerge, []), 3));